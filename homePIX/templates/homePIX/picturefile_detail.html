{% extends "homePIX/base.html" %}
{% block content %}

  <script>

    var dirty = false;

    function init() {

        var editable = document.getElementById( 'titletext' );

        editable.addEventListener('input', function() {
            dirty = true;
        });

        editable.addEventListener('blur', function() {

            if ( dirty ) {

              var pic_id = $("input#pic_id").val();
              var val    = jQuery("#titletext").text();

              $.ajax({
                url: '/keywords/change/' + pic_id,
                data: {
                  'key': 'Title',
                  'value': val
                },
                dataType: 'json',
                success: function (results) {
                  dirty = false;
                }
              });
            }
        });
    }

    $(document).ready( function() {

        $('#submit_keywords').submit( function( e ) {

          e.preventDefault();

          var pic_id     = $("input#pic_id").val();
          var vocabulary = $("input#vocabulary").val();

          $.ajax({
            url: '/keywords/add/' + pic_id,
            data: {
              'vocabulary': vocabulary
            },
            dataType: 'json',
            success: function (results) {

              reload_keyword_buttons( results, pic_id )
              $("input#vocabulary").val( "" );
            }
          });
        } );
    } );

    function remove_keyword( keyword, pic_id ) {

      $.ajax({
        url: '/keywords/remove/' + pic_id,
        data: {
          'vocabulary': keyword
        },
        dataType: 'json',
        success: function (results) {
          reload_keyword_buttons( results, pic_id )
        }
      });
    }

    window.onload = init;

  </script>

  <link rel="stylesheet" href="/static/css/clearall.css">

      <div class="techfont" id="div_8" style="min-height:100px;">
  <table id="maintab" style="padding:0px;border:0px;">
   <tr colspan=4 style="height:3em;vertical-align:middle;">
     <td>
     </td>
     <td>
          <div id="titletext" contenteditable="true">
            <h1>{{ object.title }}</h1>
          </div>
     </td>
     <td>
     </td>
     <td>
            <form action="/albums/add/{{ object.modid }}" method="get" class="float-right" style="font-size:0.5em;">
              {% csrf_token %}
              <input name="add_to_album"  type="text" placeholder="Add to album...">
            </form>
     </td>
   </tr>
   <tr colspan=4>
       <td style="width:25px;vertical-align:middle;">
           <a href=javascript:retreat()><span class="glyphicon glyphicon-chevron-left"></span></a>
       </td>
       <td id="picframe" style="width:calc(100%-370px);">
         <!--<div class="bounding-box" style="background-image:url("/{{ object.modpath }}/{{ object.file }}");">-->
           <img id="picture_8"
                class="lazyload responsive"
                style="padding:0px;"
                src="{{ object.modfile }}"
                data-src="{{ object.modlargefile }}"
                alt="{{ object.file }}"
                >
             </img>
         <!--</div>-->
       </td>
       <td style="width:25px;vertical-align:middle;">
           <a href=javascript:advance()><span class="glyphicon glyphicon-chevron-right"></span></a>
       </td>
       <td style="width:320px;">
           <div class="techfont" style="position:relative;top:0px;vertical-align:top;width:100%;height:100%;line-height:0.2em;padding:0px;">
               <span class="titletext">
                   Taken on:
               </span>
               <span id="datetime" class="titlecontent">
                   {{ object.taken_on|date:"d M, Y" }}<br>
               </span>
               <span class="titletext">
                   Filename:
               </span>
               <span id="filename" class="titlecontent">
                   {{ object.modfilename }}<br>
               </span>
               <span class="titletext">
                   ID:
               </span>
               <span id="filename" class="titlecontent">
                   {{ object.id }}<br>
               </span>
               <span class="titletext">
                   Description:
               </span>
               <span id="description" class="titlecontent">
                   {{ object.title }}<br>
               </span>
               <span class="titletext">
                   Dimensions:
               </span>
               <span id="dimensions" class="titlecontent"> ? <br> </span>
               <span id="megapixels" class="titlecontent"> ? <br></span>
               <span class="titletext">
                   AspectRatio:
               </span>
               <span id="aspect" class="titlecontent"> ? <br> </span>
               <span class="titletext">
                   Camera:
               </span>
               <span id="camera" class="titlecontent"> ? <br></span>
               <span class="titletext">
                   Exposure:
               </span>
               <span id="fnumber" class="titlecontent"> ? </span>
               <span id="exposure" class="titlecontent"> ? </span>
               <span id="exposureprogram" class="titlecontent"> ? </span>
               <span id="iso" class="titlecontent"> ? </span>
               <span id="flash" class="titlecontent"> ? <br></span>
               <span class="titletext">
                   Lens:
               </span>
               <span id="lensid" class="titlecontent"> ? <br></span>
               <span id="lens" class="titlecontent"> ? <br></span>
               <span id="focusmode" class="titlecontent"> ? <br></span>
               <span id="focusdistance" class="titlecontent"> ? <br></span>
               <span id="focallength" class="titlecontent"> ? </span>
               <span id="focallen35mm" class="titlecontent"> ? <br></span>

               <div id="panel1" style="display:inline">
                   <span class="titletext">
                       Keywords:
                   </span>
                   <span id="keywords" class="titlecontent">
                      {% for word in object.keywords.modlist %}
                        <button type="button" data-react-toolbox="button">
                        {{ word }}
                        <i class="glyphicon glyphicon-remove"></i>
                        </button>
                      {% empty %}
                        No keywords loaded
                      {% endfor %}
                   </span>
                   <form id="submit_keywords" action="" method="get" style="font-size:0.3em;">
                     {% csrf_token %}
                     <input name="vocabulary"  type="text"   id="vocabulary" placeholder="Add keywords...">
                     <input name="pic_id"      type="hidden" id="pic_id"     value="{{ object.modid }}">
                   </form>
               </div>
               <div id="panel2" style="display:none">
                   <a href=javascript:panel2() class="unembellish">
                       <span class="titletext">
                           Location:
                       </span>
                   </a>
                   <span id="map">
                       <img src=""/>
                   /<span>
               </div>
               <span class="titletext">
                   <br>Copyright
               </span>
               <span id="copyright" class="titlecontent"> ? <br></span>
           </div>
       </td>
   </tr>
 </table>
      </div>

{% endblock %}
